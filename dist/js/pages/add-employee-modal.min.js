import{PhotoLoaderMini,PhoneInputManager}from"./function_on_pages-create.js";class FileUploader{constructor(e){this.inputId=e.inputId,this.wrapperClass=e.wrapperClass,this.checkImageSize=!1!==e.checkImageSize,this.checkImageSize&&(this.minWidth=e.minWidth||800,this.minHeight=e.minHeight||800),this.renderContainerSelector=e.renderContainerSelector||"[data-render-document]",this.input=document.querySelector("#"+this.inputId),this.wrapper=document.querySelector("."+this.wrapperClass),this.errorContainer=this.wrapper,this.renderContainer=document.querySelector(this.renderContainerSelector),this.validDocuments=[],this.invalidDocuments=[],this.pendingImages=0,this.idCounter=0,this.input&&this.wrapper&&this.renderContainer?this.init():console.error("Не удалось найти необходимые DOM-элементы:",{input:this.input,wrapper:this.wrapper,renderContainer:this.renderContainer})}generateUniqueId(){return this.idCounter++,`file_${this.idCounter}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}init(){this.input.addEventListener("change",e=>this.handleFileUpload(e)),console.log("FileUploader initialized for input:",this.inputId)}clearErrors(){if(!this.wrapper||!this.errorContainer)return;this.wrapper.classList.remove("error"),this.wrapper.style.marginBottom="";this.errorContainer.querySelectorAll("ul.error-list, li.error").forEach(e=>e.remove())}displayErrors(){if(this.wrapper&&this.errorContainer&&(this.clearErrors(),this.invalidDocuments.length>0)){this.wrapper.classList.add("error"),this.wrapper.style.marginBottom=16*this.invalidDocuments.length+"px";const e=document.createElement("ul");e.classList.add("error-list"),this.invalidDocuments.forEach(t=>{const n=document.createElement("li");n.textContent=t.text,n.classList.add("error"),e.appendChild(n)}),this.errorContainer.appendChild(e)}}handleFileUpload(e){const t=Array.from(e.target.files);this.pendingImages=t.filter(e=>e.type.match("image.*")).length;const n=this.pendingImages>0;t.forEach(e=>{"application/pdf"===e.type?this.validDocuments.push({id:this.generateUniqueId(),name:e.name,size:e.size,width:null,height:null,file:e}):e.type.match("image.*")?this.handleImage(e):this.invalidDocuments.push({text:`Файл "${e.name}" не является изображением или PDF.`})}),n||(this.displayErrors(),this.render())}handleImage(e){const t=new Image,n=URL.createObjectURL(e);t.onload=()=>{URL.revokeObjectURL(n);const i=t.width,o=t.height;!this.checkImageSize||i>=this.minWidth&&o>=this.minHeight?this.validDocuments.push({id:this.generateUniqueId(),name:e.name,size:e.size,width:i,height:o,file:e}):this.invalidDocuments.push({text:`Изображение "${e.name}" (${i}x${o}) маловатое. Минимальный размер: ${this.minWidth}x${this.minHeight} пікселів.`}),this.pendingImages--,0===this.pendingImages&&(this.displayErrors(),this.render())},t.onerror=()=>{URL.revokeObjectURL(n),this.invalidDocuments.push({text:"Ошибка загрузки изображения: "+e.name}),this.pendingImages--,0===this.pendingImages&&(this.displayErrors(),this.render())},t.src=n}render(){this.renderContainer?(this.renderContainer.innerHTML="",this.validDocuments.forEach(e=>{const t=document.createElement("div");t.className="badge rounded-pill document-item","plan"===this.inputId?t.setAttribute("data-plan-id",e.id):t.setAttribute("data-document-id",e.id);const n=e.name.toLowerCase().endsWith(".pdf")?"iframe":"image",i=URL.createObjectURL(e.file);t.innerHTML=`\n                <span>${e.name}</span>\n                <button type="button" class="fancybox-button" data-fancybox data-type="${n}" data-src="${i}" aria-label="eye" data-id="${e.id}">\n                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n                    <path d="M14.5 8C14.5 8 11.6 12 8 12C4.4 12 1.5 8 1.5 8C1.5 8 4.4 4 8 4C11.6 4 14.5 8 14.5 8Z"\n                      stroke="#111111" stroke-width="1.5" stroke-miterlimit="10" stroke-linejoin="round"/>\n                    <path d="M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z"\n                      stroke="#111111" stroke-width="1.5" stroke-miterlimit="10" stroke-linejoin="round"/>\n                  </svg>\n                </button>\n                <button type="button" aria-label="Close" class="remove-document" data-id="${e.id}">\n                  <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M0.932895 9.93359C0.708205 9.93359 0.483405 9.84787 0.311951 9.67641C-0.0310669 9.3334 -0.0310669 8.77754 0.311951 8.43452L8.43461 0.311868C8.77763 -0.0310395 9.33348 -0.0310395 9.67649 0.311868C10.0194 0.654776 10.0194 1.21074 9.67649 1.55365L1.55384 9.6763C1.38239 9.84787 1.15759 9.93359 0.932895 9.93359Z"\n                      fill="#111111"/>\n                    <path d="M9.05555 9.93348C8.83075 9.93348 8.60606 9.84776 8.43461 9.6763L0.311951 1.55365C-0.0310669 1.21074 -0.0310669 0.654776 0.311951 0.311868C0.654859 -0.0310395 1.21082 -0.0310395 1.55373 0.311868L9.67638 8.43452C10.0193 8.77754 10.0193 9.3334 9.67638 9.67641C9.50504 9.84776 9.28035 9.93348 9.05555 9.93348Z"\n                      fill="#111111"/>\n                  </svg>\n                </button>\n            `,this.renderContainer.appendChild(t)}),this.addRemoveHandlers(),this.initFancybox()):console.error("Render container not found:",this.renderContainerSelector)}addRemoveHandlers(){this.renderContainer.querySelectorAll(".remove-document").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("data-id");this.removeDocument(n)})})}removeDocument(e){this.validDocuments=this.validDocuments.filter(t=>t.id!==e),this.render()}initFancybox(){"undefined"!=typeof Fancybox?Fancybox.bind("[data-fancybox]",{Thumbs:!1,Toolbar:!0,Images:{zoom:!0}}):console.warn("Fancybox is not available")}getValidFiles(){return this.validDocuments.map(e=>e.file)}clearAllFiles(){this.validDocuments=[],this.invalidDocuments=[],this.pendingImages=0,this.input.value="",this.clearErrors(),this.render()}hasFiles(){return this.validDocuments.length>0}}let phoneManager=null,select2Initialized=!1;function initPhoneInputManager(){if(!phoneManager&&document.querySelector(".btn-new-tel")&&void 0!==PhoneInputManager)try{phoneManager=new PhoneInputManager({btnSelector:".btn-new-tel",wrapperSelector:".modal-row .item.phone",inputClass:"tel-contact",maxPhones:5,initialCountry:"ua",utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@25.3.1/build/js/utils.js",countryMasks:{ua:"(99) 999-99-99",us:"(999) 999-9999",gb:"9999 999999",de:"999 99999999",fr:"9 99-99-99-99",pl:"999 999-999",it:"999 999-9999",es:"999 99-99-99",default:"(999) 999-99-99"}})}catch(e){console.error("Error initializing PhoneInputManager:",e)}}function initSelect2(){if(select2Initialized)return;const e=[{selector:"#tags-employee-modal",options:{dropdownParent:$("#add-employee-modal"),width:"100%",placeholder:"Выберите теги",language:{noResults:()=>"Результатов не найдено"}}},{selector:"#role-employee-modal",options:{dropdownParent:$("#add-employee-modal"),width:"100%",placeholder:"Выберите роль",language:{noResults:()=>"Результатов не найдено"}}},{selector:"#offices-employee-modal",options:{dropdownParent:$("#add-employee-modal"),width:"100%",placeholder:"Выберите офис",language:{noResults:()=>"Результатов не найдено"}}}];try{e.forEach(e=>{$(e.selector).length&&($(e.selector).data("select2")&&$(e.selector).select2("destroy"),$(e.selector).select2(e.options),$(e.selector).on("select2:open",(function(){setTimeout(()=>{const e=document.querySelector(".select2-search__field");e&&e.focus()},100)})))}),select2Initialized=!0,console.log("All Select2 initialized successfully")}catch(e){console.error("Error initializing Select2:",e)}}function initPhotoLoader(){new PhotoLoaderMini({inputId:"loading-photo",wrapperClass:"photo-info-list"})}function initFileUploaders(){const e=document.querySelector("#document-employee-modal"),t=document.querySelector(".loading-documents"),n=document.querySelector("[data-render-document]");e&&t&&n?(new FileUploader({inputId:"document-employee-modal",wrapperClass:"loading-documents",renderContainerSelector:"[data-render-document]",checkImageSize:!1}),console.log("FileUploader initialized in modal")):console.error("FileUploader elements not found in modal")}function initModalComponents(){initPhoneInputManager(),initSelect2(),initPhotoLoader(),initFileUploaders()}const modal=document.getElementById("add-employee-modal");modal&&(modal.addEventListener("shown.bs.modal",(function(){setTimeout(initModalComponents,300)})),modal.addEventListener("hidden.bs.modal",(function(){phoneManager&&"function"==typeof phoneManager.destroy&&(phoneManager.destroy(),phoneManager=null);["#tags-employee-modal","#role-employee-modal","#offices-employee-modal"].forEach(e=>{$(e).data("select2")&&$(e).select2("destroy")}),select2Initialized=!1,console.log("All components destroyed")}))),$("#datapiker").daterangepicker({locale:{format:"DD-MM-YYYY",separator:" - ",applyLabel:"Применить",cancelLabel:"Отмена",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"Н",daysOfWeek:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],firstDay:1},drops:"auto"}),$("#employee-datapiker").daterangepicker({autoUpdateInput:!0,singleDatePicker:!0,locale:{format:"DD-MM-YYYY",separator:" - ",applyLabel:"Применить",cancelLabel:"Отмена",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"Н",daysOfWeek:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],firstDay:1},drops:"auto"});const style=document.createElement("style");style.textContent="\n    .select2-container.select2-dropdown {\n        z-index: 1060 !important;\n    }\n    .modal .select2-container--open {\n        z-index: 1060 !important;\n    }\n    .select2-search__field {\n        width: 100% !important;\n    }\n",document.head.appendChild(style);