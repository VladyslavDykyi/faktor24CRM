"use strict";document.addEventListener("DOMContentLoaded",(function(){let e=null,t=null,n=null;function o(e){const t=document.getElementById("latitude"),o=document.getElementById("longitude");t&&(t.value=e.lat.toFixed(6)),o&&(o.value=e.lng.toFixed(6)),n&&clearTimeout(n),n=setTimeout(()=>{!function(e,t){const n=document.getElementById("addressStatus");n&&(n.textContent="Отримуємо адресу...",n.className="address-status loading"),fetch("https://corsproxy.io/?"+encodeURIComponent(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1&namedetails=1&accept-language=uk`)).then(e=>{if(!e.ok)throw new Error("Мережева помилка");return e.json()}).then(e=>{if(e&&e.address){const t=e.address;let o="";t.country&&(o+=t.country),t.state&&(o+=(o?", ":"")+t.state);let s=!1;t.city?(o+=(o?", ":"")+t.city,s=!0):t.town?(o+=(o?", ":"")+t.town,s=!0):t.village&&(o+=(o?", ":"")+t.village,s=!0),t.residential&&s?o+=(o?", ":"")+t.residential:t.borough&&s?o+=(o?", ":"")+t.borough:t.district&&!s&&(o+=(o?", ":"")+t.district),t.road&&(o+=(o?", ":"")+t.road),t.house_number&&(o+=(o?", ":"")+t.house_number),!o&&e.display_name&&(o=e.display_name);const a=document.getElementById("address");a&&(a.value=o),n&&(n.textContent="Адресу отримано успішно",n.className="address-status success")}else{const e=document.getElementById("address");e&&(e.value="Адресу не знайдено"),n&&(n.textContent="Адресу не знайдено для цих координат",n.className="address-status error")}}).catch(e=>{console.error("Помилка отримання адреси:",e);const t=document.getElementById("address");t&&(t.value="Не вдалося отримати адресу"),n&&(n.textContent="Помилка отримання адреси. Спробуйте пізніше.",n.className="address-status error")})}(e.lat,e.lng)},800)}const s=document.getElementById("geoModal");s&&(s.addEventListener("shown.bs.modal",(function(){e?setTimeout((function(){e.invalidateSize(),o(e.getCenter())}),100):(e=L.map("map-container").setView([48.465,35.04],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(e),t=L.marker(e.getCenter(),{draggable:!0,title:"Перетягніть мене"}).addTo(e),t.on("dragend",(function(){o(t.getLatLng())})),e.on("move",(function(){t&&(t.setLatLng(e.getCenter()),o(e.getCenter()))})),e.on("zoomend",(function(){t&&o(e.getCenter())})),o(e.getCenter()))})),s.addEventListener("hidden.bs.modal",(function(){e&&(e.remove(),e=null,t=null)})));const a=document.getElementById("saveLocation");a&&a.addEventListener("click",(function(){const e=document.getElementById("address"),t=document.getElementById("latitude"),n=document.getElementById("longitude"),o=e?e.value:"",a=t?t.value:"",d=n?n.value:"";alert(`Локацію збережено!\nАдреса: ${o}\nКоординати: ${a}, ${d}`);const r=bootstrap.Modal.getInstance(s);r&&r.hide()}))}));